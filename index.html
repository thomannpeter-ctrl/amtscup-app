<script>
  /////////////////////////////////////////////////
  //  Gruppen laden aus TEXT-Datei statt CSV
  /////////////////////////////////////////////////

  const DEFAULT_GROUPS_TEXT = `Keine Gruppen geladen – Fallback aktiviert.`;

  let groupsList = [];

  function parseGroups(text) {
    return text
      .split(/\r?\n/)
      .map(l => l.trim())
      .filter(l => l.length > 0);
  }

  // NEU: LÄDT gruppen.txt STATT gruppen.csv
  function loadGroups() {
    const selects = [
      document.getElementById("gruppe1Select"),
      document.getElementById("gruppe2Select"),
      document.getElementById("gruppe3Select")
    ];

    // Select-Felder leeren + Platzhalter
    selects.forEach(select => {
      select.innerHTML = "";
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = "Bitte wählen …";
      select.appendChild(opt);
    });

    // → Dateiformat jetzt .txt – keine CSV-Fehler mehr
    fetch("Daten/gruppen.txt")
      .then(response => response.text())
      .then(text => {
        const lines = parseGroups(text);

        groupsList = lines; // Jede Zeile = ein Eintrag

        selects.forEach(select => {
          lines.forEach(line => {
            const opt = document.createElement("option");
            opt.value = line;
            opt.textContent = line;
            select.appendChild(opt);
          });
        });

        const area = document.getElementById("groupsText");
        area.value = text;
        area.readOnly = true;

        updateGroupTitles();
      })
      .catch(err => {
        console.error("Fehler beim Laden gruppen.txt:", err);

        groupsList = parseGroups(DEFAULT_GROUPS_TEXT);
        selects.forEach(select => {
          groupsList.forEach(g => {
            const opt = document.createElement("option");
            opt.value = g;
            opt.textContent = g;
            select.appendChild(opt);
          });
        });
      });
  }

  function getEffectiveGroupName(which) {
    const select = document.getElementById(`gruppe${which}Select`).value.trim();
    const other = document.getElementById(`gruppe${which}Other`).value.trim();
    return other || select || "";
  }

  function updateGroupTitles() {
    document.getElementById("gruppe1TitleLabel").textContent =
      "2. Schützen & Resultate – " + (getEffectiveGroupName(1) || "Gruppe 1");
    document.getElementById("gruppe2TitleLabel").textContent =
      "3. Schützen & Resultate – " + (getEffectiveGroupName(2) || "Gruppe 2");
    document.getElementById("gruppe3TitleLabel").textContent =
      "4. Schützen & Resultate – " + (getEffectiveGroupName(3) || "Gruppe 3");

    document.getElementById("compareGroup1Label").textContent = getEffectiveGroupName(1);
    document.getElementById("compareGroup2Label").textContent = getEffectiveGroupName(2);
    document.getElementById("compareGroup3Label").textContent = getEffectiveGroupName(3);
  }

  /////////////////////////////////////////////////
  //  INIT
  /////////////////////////////////////////////////

  window.addEventListener("load", () => {
    loadGroups();
  });
</script>
