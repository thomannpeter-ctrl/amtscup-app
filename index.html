<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: system-ui, sans-serif;
  background: #eef2f7;
  margin: 0;
  padding: 1rem;
}
.card {
  background: white;
  padding: 1rem;
  margin-bottom: 1rem;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,.08);
}
h1 { color: #1e3a8a; }
h2 { color: #2563eb; font-size: 1.1rem; }
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #ddd;
  padding: .3rem;
  text-align: center;
}
input, select, button {
  width: 100%;
  padding: .4rem;
  border-radius: 6px;
}
button {
  background: #2563eb;
  color: white;
  border: none;
  cursor: pointer;
}
.sum {
  font-weight: bold;
  background: #f3f4f6;
}
</style>
</head>

<body>

<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
  <h2>Gruppen</h2>
  <select id="gruppe1"></select>
  <select id="gruppe2"></select>
</div>

<div class="card">
  <h2>SchÃ¼tzen â€“ Gruppe 1</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Resultat</th></tr>
    </thead>
    <tbody id="g1"></tbody>
    <tfoot>
      <tr><td>Summe</td><td id="sum1" class="sum"></td></tr>
    </tfoot>
  </table>
</div>

<div class="card">
  <h2>SchÃ¼tzen â€“ Gruppe 2</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Resultat</th></tr>
    </thead>
    <tbody id="g2"></tbody>
    <tfoot>
      <tr><td>Summe</td><td id="sum2" class="sum"></td></tr>
    </tfoot>
  </table>
</div>

<div class="card">
  <button onclick="exportExcel()">ðŸ“„ Excel exportieren</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const GROUPS_URL =
  "https://raw.githubusercontent.com/thomannpeter-ctrl/amtscup-app/hauptsÃ¤chlich/gruppen.txt";

function makeRows(tbody) {
  for (let i = 0; i < 5; i++) {
    const tr = document.createElement("tr");
    tr.innerHTML =
      '<td><input></td><td><input type="number"></td>';
    tbody.appendChild(tr);
  }
}

function sumTable(tbody) {
  let sum = 0;
  tbody.querySelectorAll("input[type=number]").forEach(i => {
    sum += parseInt(i.value) || 0;
  });
  return sum;
}

async function loadGroups() {
  let txt = "";
  try {
    const r = await fetch(GROUPS_URL);
    txt = await r.text();
  } catch {
    txt = "Gruppe A\nGruppe B";
  }
  const groups = txt.split(/\r?\n/).filter(x => x.trim());
  [gruppe1, gruppe2].forEach(sel => {
    sel.innerHTML = "";
    groups.forEach(g => {
      const o = document.createElement("option");
      o.textContent = g;
      sel.appendChild(o);
    });
  });
}

function exportExcel() {
  const data = [
    ["Gruppe 1", gruppe1.value, sumTable(g1)],
    ["Gruppe 2", gruppe2.value, sumTable(g2)]
  ];
  const ws = XLSX.utils.aoa_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Amtscup");
  XLSX.writeFile(wb, "amtscup.xlsx");
}

makeRows(g1);
makeRows(g2);
loadGroups();

setInterval(() => {
  sum1.textContent = sumTable(g1);
  sum2.textContent = sumTable(g2);
}, 500);
</script>

</body>
</html>
