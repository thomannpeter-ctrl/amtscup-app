/* ---------------------------  
   GitHub Gruppenliste laden  
--------------------------- */

const GITHUB_GROUPS_URL =
  "https://raw.githubusercontent.com/thomannpeter-ctrl/amtscup-App/main/gruppen.txt";

async function fetchGroupsFromGitHub() {
  try {
    const res = await fetch(GITHUB_GROUPS_URL);
    if (!res.ok) throw new Error("HTTP " + res.status);
    const txt = await res.text();
    if (txt.trim().length < 3) throw new Error("Leere Datei");
    return txt;
  } catch (err) {
    console.warn("GitHub Gruppenliste konnte nicht geladen werden:", err);
    return null; // Fallback verwenden
  }
}


/* ------------------------------------------
   NEUE loadGroups() – alte Version löschen!
------------------------------------------- */

async function loadGroups() {

  // 1) Admin-Eintrag aus localStorage?
  const stored = localStorage.getItem("amtscupGroupsText");
  let text = stored && stored.trim().length > 0 ? stored : null;

  // 2) Wenn kein Admin-Override → GitHub versuchen
  if (!text) {
    const txtGitHub = await fetchGroupsFromGitHub();
    if (txtGitHub) {
      text = txtGitHub;
    }
  }

  // 3) Fallback – Standardliste
  if (!text) {
    text = DEFAULT_GROUPS_TEXT;
  }

  // 4) Text in Liste umwandeln
  groupsList = parseGroups(text);

  // 5) Select-Felder füllen
  const selects = [
    document.getElementById("gruppe1Select"),
    document.getElementById("gruppe2Select"),
    document.getElementById("gruppe3Select")
  ];

  selects.forEach(select => {
    if (!select) return;
    select.innerHTML = "";
    const placeholderOpt = document.createElement("option");
    placeholderOpt.value = "";
    placeholderOpt.textContent = "Bitte wählen …";
    select.appendChild(placeholderOpt);

    groupsList.forEach(g => {
      const opt = document.createElement("option");
      opt.value = g;
      opt.textContent = g;
      select.appendChild(opt);
    });
  });

  // 6) Admin-Textfeld aktualisieren
  const area = document.getElementById("groupsText");
  if (area) {
    area.value = text;
  }

  updateGroupTitles();
}
